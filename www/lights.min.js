function v(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){4===this.readyState&&200===this.status&&JSON.parse(this.responseText)};b.open("PUT","http://192.168.1.185/api/qRZ0f2agZeihyCWSBBpWPRUpRg03n9VuXTcRHtHq/lights/2/state",!0);b.send("string"===typeof a?a:JSON.stringify(a))}function A(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var b=JSON.parse(this.responseText);"function"===typeof a&&a(b.state)}};b.open("GET","http://192.168.1.185/api/qRZ0f2agZeihyCWSBBpWPRUpRg03n9VuXTcRHtHq/lights/2");b.send()}function E(a,b,c){var m,n,h,g,l,k,q;1===arguments.length&&(b=a.c,c=a.a,a=a.b);g=6*a|0;l=6*a-g;k=c*(1-b);q=c*(1-l*b);l=c*(1-(1-l)*b);switch(g%6){case 0:m=c;n=l;h=k;break;case 1:m=q;n=c;h=k;break;case 2:m=k;n=c;h=l;break;case 3:m=k;n=q;h=c;break;case 4:m=l;n=k;h=c;break;case 5:m=c,n=k,h=q}return{r:255*m|0,g:255*n|0,f:255*h|0}}function F(a,b,c){1===arguments.length&&(b=a.g,c=a.f,a=a.r);a/=255;b/=255;c/=255;var m,n,h,g,l,k=Math.max(a,b,c);h=k-Math.min(a,b,c);0===h?g=l=0:(l=h/k,m=(k-a)/6/h+.5,n=(k-b)/6/h+.5,h=(k-c)/6/h+.5,a===k?g=h-n:b===k?g=1/3+m-h:c===k&&(g=2/3+n-m),0>g?g+=1:1<g&&--g);return{b:g,c:l,a:k}}function G(a){"string"===typeof a&&(a=parseInt(a.replace(/^#/,""),16));return F((a&16711680)>>16,(a&65280)>>8,(a&255)>>0)}function H(a,b,c){1===arguments.length&&(b=a.g,c=a.f,a=a.r);return"#"+("00000"+((a<<16)+(b<<8)+c).toString(16)).slice(-6)}function J(a,b,c){1===arguments.length&&(b=a.c,c=a.a,a=a.b);return H(E(a,b,c))}function K(){A(function(a){v({l:!a.l})})}function L(a){var b=G(a);a="string"===typeof a?a:"#"+("00000"+a.toString(16)).slice(-6);v({i:65535*b.b|0,j:255*b.c|0,h:255*b.a|0});document.body.style.backgroundColor=a}function M(a,b){a.style.transition="opacity 100ms";a.style.opacity=0;setTimeout(function(){"function"===typeof b&&b();a.style.opacity=1},100)}document.addEventListener("DOMContentLoaded",function(){function a(a,b){var c="string"===typeof a?a:"#"+("00000"+a.toString(16)).slice(-6);b=b||G(a);v({i:65535*b.b|0,j:255*b.c|0,h:255*b.a|0});document.body.style.backgroundColor=c;f.b=b.b;f.c=b.c;f.a=b.a;q&&(q.value=c)}function b(){var b=4*(400*B.y+B.x);0!==e.data[b+3]&&(f.r=e.data[b],f.g=e.data[b+1],f.f=e.data[b+2],f.m=e.data[b+3],b=F(f),f.b=b.b,f.c=b.c,f.a=b.a,b=(f.r<<16)+(f.g<<8)+f.f,a(b,f))}function c(){switch(I[u]){case "hue-sat":var a,b,c;for(d=0;d<e.data.length;d+=4)t=d/4%400|0,r=d/4/400|0,w=Math.sqrt(Math.pow(t-200,2)+Math.pow(r-200,2)),200<=w?(e.data[d]=0,e.data[d+1]=0,e.data[d+2]=0,e.data[d+3]=0):(x=Math.atan2(r-200,t-200),a=x/(2*Math.PI),0>a&&(a+=1),b=w/200,c=f.a,a=E(a,b,c),e.data[d]=a.r,e.data[d+1]=a.g,e.data[d+2]=a.f,e.data[d+3]=255);break;case "bri":for(d=0;d<e.data.length;d+=4)t=d/4%400|0,r=d/4/400|0,w=Math.sqrt(Math.pow(t-200,2)+Math.pow(r-200,2)),200<=w?(e.data[d]=0,e.data[d+1]=0,e.data[d+2]=0,e.data[d+3]=0):(a=f.b,b=f.c,c=Math.max(1-r/400,.01),a=E(a,b,c),e.data[d]=a.r,e.data[d+1]=a.g,e.data[d+2]=a.f,e.data[d+3]=255)}y.putImageData(e,0,0)}function m(){u=(u+1)%I.length;M(z,c)}function n(){b();clearInterval(D);D=setInterval(b,100)}function h(a){var b=p.getBoundingClientRect();B.x=(a.clientX||a.targetTouches[0].pageX)-b.left|0;B.y=(a.clientY||a.targetTouches[0].pageY)-b.top|0}function g(){clearInterval(D)}function l(b){var d=f.a;b.preventDefault();d+=b.wheelDelta/2E3;f.a=1<d?1:.02>d?.02:d;c();a(J(f),f)}var k=document.getElementById("toggle"),q=document.getElementById("colour"),z=document.getElementById("colour-wheel"),C=document.getElementById("mode"),p,y,e,d,t,r,w,x,u=0,I=["hue-sat","bri"],f={b:0,c:0,a:1,o:16777215,r:255,g:255,f:255,m:255},B={x:0,y:0},D;k&&k.addEventListener("click",K);q&&q.addEventListener("change",function(){a(q.value);c()});C&&C.addEventListener("click",m);z&&(p=document.createElement("canvas"),p.width=400,p.height=400,z.appendChild(p),y=p.getContext("2d"),e=y.getImageData(0,0,400,400),c(),A(function(a){document.getElementById("connecting").style.display="none";f.b=a.i/65535;f.c=a.j/255;f.a=a.h/255;a=E(f);f.r=a.r;f.g=a.g;f.f=a.f;a=H(a);document.body.style.backgroundColor=a;q&&(q.value=a);c();p.addEventListener("mousedown",n,!1);p.addEventListener("mousemove",h,!1);p.addEventListener("mouseup",g,!1);document.body.addEventListener("mouseout",g,!1);p.addEventListener("touchstart",n,!1);p.addEventListener("touchmove",h,!1);p.addEventListener("touchend",g,!1);p.addEventListener("mousewheel",l,!1);p.addEventListener("dblclick",m,!1)}))});document.addEventListener("DOMContentLoaded",function(){function a(a){var b=a.target.parentElement.parentElement.getElementsByClassName("val-td")[0].getElementsByTagName("input"),c;for(c=0;c<b.length;c+=1)b[c].style.display="none";switch(a.target.value){case "Colour":b[0].style.display="inline";break;case "On/Off":b[1].style.display="inline";break;default:b[2].style.display="inline"}}function b(a){a=a.target.parentElement.parentElement;a.parentElement.removeChild(a)}function c(a){if(a<l.rows.length-1){var b=l.rows[a],d=b.cells[1].getElementsByClassName("val"),e=1E3*parseInt(b.cells[2].getElementsByClassName("time")[0].value,10);switch(b.cells[0].getElementsByClassName("param")[0].value){case "Colour":L(d[0].value);break;case "Hue":v({i:65535*parseFloat(d[2].value)|0});break;case "Saturation":v({j:255*parseFloat(d[2].value)|0});break;case "Brightness":v({h:255*parseFloat(d[2].value)|0});break;case "On/Off":v({l:d[1].checked})}r&&(t=setTimeout(function(){c(a+1)},e))}else w.classList.contains("checked")&&c(1)}function m(){r=!1;clearTimeout(t);e.classList.remove("hidden");d.classList.add("hidden")}function n(){g.style.display="none";m()}function h(a){a.target.classList.contains("checked")?a.target.classList.remove("checked"):a.target.classList.add("checked")}var g=document.getElementById("anim"),l=document.getElementById("anim-table"),k=document.getElementsByTagName("tbody")[0],q=document.getElementById("show-anim"),z=document.getElementById("add-frame"),C=g.getElementsByClassName("param")[0],p=g.getElementsByClassName("delete-row")[0],y=g.getElementsByClassName("close")[0],e=document.getElementById("play-animation"),d=document.getElementById("stop-animation"),t,r=!0,w=document.getElementById("loop-anim"),x=g.getElementsByClassName("toggle"),u;for(u=0;u<x.length;u+=1)x[u].addEventListener("click",h,!1);C.addEventListener("change",a,!1);p.addEventListener("click",b,!1);q.addEventListener("click",function(){"block"===g.style.display?n():g.style.display="block"},!1);y.addEventListener("click",n,!1);z.addEventListener("click",function(){var c=l.rows.length-2,d=l.rows[c],e=d.cloneNode(!0),c=l.rows[c+1];e.getElementsByClassName("delete-row")[0].addEventListener("click",b,!1);e.getElementsByClassName("param")[0].addEventListener("change",a);e.getElementsByClassName("param")[0].value=d.getElementsByClassName("param")[0].value;k.insertBefore(e,c)},!1);e.addEventListener("click",function(){clearTimeout(t);r=!0;c(1);e.classList.add("hidden");d.classList.remove("hidden")},!1);d.addEventListener("click",m,!1)});
