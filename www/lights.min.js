function y(){return"http://"+this.u+"/api/"+this.w+"/lights/"+this.v}function z(){return this.s()+"/state"}function A(a){var h=new XMLHttpRequest;h.onreadystatechange=function(){4===this.readyState&&200===this.status&&JSON.parse(this.responseText)};h.open("PUT",z(),!0);h.send("string"===typeof a?a:JSON.stringify(a))}function B(a){var h=new XMLHttpRequest;h.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var f=JSON.parse(this.responseText);"function"===typeof a&&a(f.state)}};h.open("GET",y());h.send()}function E(a,h,f){var p,m,g,l,n,c,q;1===arguments.length&&(h=a.b,f=a.c,a=a.a);l=6*a|0;n=6*a-l;c=f*(1-h);q=f*(1-n*h);n=f*(1-(1-n)*h);switch(l%6){case 0:p=f;m=n;g=c;break;case 1:p=q;m=f;g=c;break;case 2:p=c;m=f;g=n;break;case 3:p=c;m=q;g=f;break;case 4:p=n;m=c;g=f;break;case 5:p=f,m=c,g=q}return{r:255*p|0,g:255*m|0,f:255*g|0}}function F(a,h,f){1===arguments.length&&(h=a.g,f=a.f,a=a.r);a/=255;h/=255;f/=255;var p,m,g,l,n,c=Math.max(a,h,f);g=c-Math.min(a,h,f);0===g?l=n=0:(n=g/c,p=(c-a)/6/g+.5,m=(c-h)/6/g+.5,g=(c-f)/6/g+.5,a===c?l=g-m:h===c?l=1/3+p-g:f===c&&(l=2/3+m-p),0>l?l+=1:1<l&&--l);return{a:l,b:n,c:c}}function G(){B(function(a){A({m:!a.m})})}document.addEventListener("DOMContentLoaded",function(){function a(b){var a,c="string"===typeof b?b:"#"+("00000"+b.toString(16)).slice(-6);a||("string"===typeof b&&(b=parseInt(b.replace(/^#/,""),16)),a=F((b&16711680)>>16,(b&65280)>>8,(b&255)>>0));A({l:65535*a.a|0,o:255*a.b|0,i:255*a.c|0});document.body.style.backgroundColor=c;k.a=a.a;k.b=a.b;k.c=a.c;g&&(g.value=c)}function h(){var b=4*(400*v.y+v.x);k.r=e.data[b];k.g=e.data[b+1];k.f=e.data[b+2];k.h=e.data[b+3];b=F(k);k.a=b.a;k.b=b.b;k.c=b.c;b=(k.r<<16)+(k.g<<8)+k.f;k.j=b;0!==k.h&&a(b)}function f(){switch(C[x]){case "hue-sat":var b,a,c;for(d=0;d<e.data.length;d+=4)t=d/4%400|0,r=d/4/400|0,u=Math.sqrt(Math.pow(t-200,2)+Math.pow(r-200,2)),200<=u?(e.data[d]=0,e.data[d+1]=0,e.data[d+2]=0,e.data[d+3]=0):(D=Math.atan2(r-200,t-200),b=D/(2*Math.PI),0>b&&(b+=1),a=u/200,c=k.c,b=E(b,a,c),e.data[d]=b.r,e.data[d+1]=b.g,e.data[d+2]=b.f,e.data[d+3]=255);break;case "bri":for(d=0;d<e.data.length;d+=4)t=d/4%400|0,r=d/4/400|0,u=Math.sqrt(Math.pow(t-200,2)+Math.pow(r-200,2)),200<=u?(e.data[d]=0,e.data[d+1]=0,e.data[d+2]=0,e.data[d+3]=0):(b=k.a,a=k.b,c=Math.max(1-r/400,.01),b=E(b,a,c),e.data[d]=b.r,e.data[d+1]=b.g,e.data[d+2]=b.f,e.data[d+3]=255)}q.putImageData(e,0,0)}function p(){x=(x+1)%C.length;f()}var m=document.getElementById("toggle"),g=document.getElementById("colour"),l=document.getElementById("colour-wheel"),n=document.getElementById("mode"),c,q,e,d,t,r,u,D,x=0,C=["hue-sat","bri"],k={a:0,b:0,c:1,j:16777215,r:255,g:255,f:255,h:255},v={x:0,y:0},w;m&&m.addEventListener("click",G);g&&g.addEventListener("change",function(){a(g.value);f()});n&&n.addEventListener("click",p);l&&B(function(a){k.a=a.l/65535;k.b=a.o/255;k.c=a.i/255;c=document.createElement("canvas");c.width=400;c.height=400;l.appendChild(c);q=c.getContext("2d");e=q.getImageData(0,0,400,400);f();c.addEventListener("mousemove",function(a){var b=c.getBoundingClientRect();v.x=a.clientX-b.left|0;v.y=a.clientY-b.top|0});c.addEventListener("mousedown",function(){h();clearInterval(w);w=setInterval(h,100)});c.addEventListener("mouseup",function(){clearInterval(w)});document.body.addEventListener("mouseout",function(){clearInterval(w)})})});
