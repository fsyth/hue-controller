function x(){return"http://"+this.u+"/api/"+this.w+"/lights/"+this.v}function z(){return this.s()+"/state"}function A(a){var g=new XMLHttpRequest;g.onreadystatechange=function(){4===this.readyState&&200===this.status&&JSON.parse(this.responseText)};g.open("PUT",z(),!0);g.send("string"===typeof a?a:JSON.stringify(a))}function B(a){var g=new XMLHttpRequest;g.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var d=JSON.parse(this.responseText);"function"===typeof a&&a(d.state)}};g.open("GET",x());g.send()}function E(a,g,d){var p,m,h,l,n,c,q;1===arguments.length&&(g=a.f,d=a.g,a=a.c);l=6*a|0;n=6*a-l;c=d*(1-g);q=d*(1-n*g);n=d*(1-(1-n)*g);switch(l%6){case 0:p=d;m=n;h=c;break;case 1:p=q;m=d;h=c;break;case 2:p=c;m=d;h=n;break;case 3:p=c;m=q;h=d;break;case 4:p=n;m=c;h=d;break;case 5:p=d,m=c,h=q}return{r:255*p|0,b:255*m|0,a:255*h|0}}function F(a,g,d){1===arguments.length&&(g=a.b,d=a.a,a=a.r);a/=255;g/=255;d/=255;var p,m,h,l,n,c=Math.max(a,g,d);h=c-Math.min(a,g,d);0===h?l=n=0:(n=h/c,p=(c-a)/6/h+.5,m=(c-g)/6/h+.5,h=(c-d)/6/h+.5,a===c?l=h-m:g===c?l=1/3+p-h:d===c&&(l=2/3+m-p),0>l?l+=1:1<l&&--l);return{c:l,f:n,g:c}}function G(a,g,d){1===arguments.length&&(g=a.b,d=a.a,a=a.r);return"#"+("00000"+((a<<16)+(g<<8)+d).toString(16)).slice(-6)}function H(){B(function(a){A({m:!a.m})})}document.addEventListener("DOMContentLoaded",function(){function a(b){var a,c="string"===typeof b?b:"#"+("00000"+b.toString(16)).slice(-6);a||("string"===typeof b&&(b=parseInt(b.replace(/^#/,""),16)),a=F((b&16711680)>>16,(b&65280)>>8,(b&255)>>0));A({l:65535*a.c|0,o:255*a.f|0,i:255*a.g|0});document.body.style.backgroundColor=c;e.c=a.c;e.f=a.f;e.g=a.g;h&&(h.value=c)}function g(){var b=4*(400*v.y+v.x);e.r=k.data[b];e.b=k.data[b+1];e.a=k.data[b+2];e.h=k.data[b+3];b=F(e);e.c=b.c;e.f=b.f;e.g=b.g;b=(e.r<<16)+(e.b<<8)+e.a;e.j=b;0!==e.h&&a(b)}function d(){switch(C[y]){case "hue-sat":var b,a,c;for(f=0;f<k.data.length;f+=4)t=f/4%400|0,r=f/4/400|0,u=Math.sqrt(Math.pow(t-200,2)+Math.pow(r-200,2)),200<=u?(k.data[f]=0,k.data[f+1]=0,k.data[f+2]=0,k.data[f+3]=0):(D=Math.atan2(r-200,t-200),b=D/(2*Math.PI),0>b&&(b+=1),a=u/200,c=e.g,b=E(b,a,c),k.data[f]=b.r,k.data[f+1]=b.b,k.data[f+2]=b.a,k.data[f+3]=255);break;case "bri":for(f=0;f<k.data.length;f+=4)t=f/4%400|0,r=f/4/400|0,u=Math.sqrt(Math.pow(t-200,2)+Math.pow(r-200,2)),200<=u?(k.data[f]=0,k.data[f+1]=0,k.data[f+2]=0,k.data[f+3]=0):(b=e.c,a=e.f,c=Math.max(1-r/400,.01),b=E(b,a,c),k.data[f]=b.r,k.data[f+1]=b.b,k.data[f+2]=b.a,k.data[f+3]=255)}q.putImageData(k,0,0)}function p(){y=(y+1)%C.length;d()}var m=document.getElementById("toggle"),h=document.getElementById("colour"),l=document.getElementById("colour-wheel"),n=document.getElementById("mode"),c,q,k,f,t,r,u,D,y=0,C=["hue-sat","bri"],e={c:0,f:0,g:1,j:16777215,r:255,b:255,a:255,h:255},v={x:0,y:0},w;m&&m.addEventListener("click",H);h&&h.addEventListener("change",function(){a(h.value);d()});n&&n.addEventListener("click",p);l&&B(function(a){e.c=a.l/65535;e.f=a.o/255;e.g=a.i/255;a=E(e);e.r=a.r;e.b=a.b;e.a=a.a;a=G(a);document.body.style.backgroundColor=a;h&&(h.value=a);c=document.createElement("canvas");c.width=400;c.height=400;l.appendChild(c);q=c.getContext("2d");k=q.getImageData(0,0,400,400);d();c.addEventListener("mousemove",function(a){var b=c.getBoundingClientRect();v.x=a.clientX-b.left|0;v.y=a.clientY-b.top|0});c.addEventListener("mousedown",function(){g();clearInterval(w);w=setInterval(g,100)});c.addEventListener("mouseup",function(){clearInterval(w)});document.body.addEventListener("mouseout",function(){clearInterval(w)})})});
